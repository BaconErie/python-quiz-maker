<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <script src="https://cdn.jsdelivr.net/pyodide/v0.27.7/full/pyodide.js"></script>

    <link rel="stylesheet" href="theme.css" />
    <link rel="stylesheet" href="editor.css" />
    <title>Code editor</title>
  </head>

  <body
    x-data="{
    editorContent: '',
    outputLines: [],
    pyodide: null
  }"
    x-init="
    pyodide = await loadPyodide(); 
    pyodide.setStdout({ batched: (msg) => (outputLines.push(msg)) });
    "
  >
    <div id="loadingScreen" x-show="pyodide == null">
      <div id="modal">Loading Python...</div>
    </div>

    <div id="wrapper">
      <h1>Editor</h1>
      <textarea
        @keydown.tab.prevent="editorContent += '    '"
        id="editor"
        x-model="editorContent"
        placeholder="Enter your code here"
      >
      </textarea>

      <button
        id="runButton"
        @click="
        outputLines = []

        try {
          pyodide.runPython(editorContent)
        } catch (error) {
          for (line of error.message.split('\n')) {
            console.log(line)
            outputLines.push(line)
          } 
        }

        console.log(outputLines)
      "
      >
        Run
      </button>

      <h1>Output</h1>
      <div id="output">
        <template x-for="(line, index) in outputLines" :key="index">
          <div x-text="line" style="height: 1rem; white-space: pre"></div>
        </template>
      </div>
    </div>
  </body>
</html>
